<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GitHub ç›®å½•æµè§ˆ & Markdown é¢„è§ˆï¼ˆæç®€ç‰ˆï¼‰</title>
  <style>
    :root { --bg:#fff; --fg:#111; --muted:#777; --border:#e5e5e5; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans SC", "Microsoft YaHei", sans-serif; background: var(--bg); color: var(--fg); }
    header { padding: 12px 16px; border-bottom: 1px solid var(--border); display:flex; gap:12px; align-items:center; flex-wrap: wrap; }
    header .repo { font-weight: 700; }
    #app { display: grid; grid-template-columns: 320px 1fr; min-height: calc(100vh - 57px); }
    @media (max-width: 900px) { #app { grid-template-columns: 1fr; } }
    aside { border-right: 1px solid var(--border); padding: 12px; }
    main { padding: 16px; }
    .breadcrumb { font-size: 14px; color: var(--muted); margin-bottom: 8px; word-break: break-all; }
    .breadcrumb a { color: inherit; text-decoration: none; border-bottom: 1px dotted var(--border); }
    .section-title { font-size: 14px; font-weight: 700; margin: 12px 0 6px; }
    ul { list-style: none; padding: 0; margin: 0; }
    li { display: flex; align-items: center; gap: 8px; padding: 8px 6px; border-radius: 8px; cursor: pointer; }
    li:hover { background: #f7f7f7; }
    .muted { color: var(--muted); font-size: 12px; }
    .row { display:flex; justify-content: space-between; gap:8px; width:100%; }
    .name { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .badge { border:1px solid var(--border); padding:2px 6px; border-radius:999px; font-size:12px; color: var(--muted); }
    .readme { border-top: 1px solid var(--border); margin-top: 24px; padding-top: 16px; }
    .md { line-height: 1.75; }
    .md pre { overflow: auto; background:#f6f8fa; padding:12px; border-radius:8px; }
    .md code { background:#f6f8fa; padding:2px 4px; border-radius:4px; }
    .empty { color: var(--muted); padding: 8px 0; }
    .toolbar { display:flex; gap:8px; align-items:center; }
    button { appearance: none; border:1px solid var(--border); background:#fafafa; padding:6px 10px; border-radius:8px; cursor:pointer; }
    button:hover { background:#f2f2f2; }
  </style>
  <!-- è½»é‡ Markdown æ¸²æŸ“ï¼šmarked -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <header>
    <div class="repo" id="repoTitle"></div>
    <div class="toolbar">
      <span class="muted">åˆ†æ”¯ï¼š</span>
      <select id="branchSelect"></select>
      <button id="homeBtn">å›åˆ°æ ¹ç›®å½•</button>
    </div>
  </header>

  <div id="app">
    <aside>
      <div class="breadcrumb" id="breadcrumb"></div>
      <div class="section">
        <div class="section-title">å½“å‰ç›®å½•</div>
        <ul id="list"></ul>
      </div>
    </aside>
    <main>
      <div id="content" class="md"></div>
      <div id="readme" class="md readme"></div>
    </main>
  </div>

  <script>
    // === é…ç½®åŒºï¼šæŠŠä¸‹é¢ä¸‰é¡¹æ”¹æˆä½ çš„ä»“åº“ä¿¡æ¯ ===
    const REPO_OWNER = 'mck156'; // â† GitHub ç”¨æˆ·å / ç»„ç»‡å
    const REPO_NAME  = 'mck156.github.io'; // â† ä»“åº“å
    const DEFAULT_BRANCH = 'main'; // â† åˆ†æ”¯åï¼ˆå¸¸è§ä¸º main æˆ– masterï¼‰
    // ============================================

    const state = {
      owner: REPO_OWNER,
      repo: REPO_NAME,
      branch: DEFAULT_BRANCH,
      path: '' // å½“å‰æµè§ˆè·¯å¾„ï¼ˆç›¸å¯¹ä»“åº“æ ¹ï¼‰
    };

    const els = {
      repoTitle: document.getElementById('repoTitle'),
      list: document.getElementById('list'),
      content: document.getElementById('content'),
      readme: document.getElementById('readme'),
      breadcrumb: document.getElementById('breadcrumb'),
      branchSelect: document.getElementById('branchSelect'),
      homeBtn: document.getElementById('homeBtn'),
    };

    els.homeBtn.addEventListener('click', () => loadPath(''));

    function setTitle() {
      els.repoTitle.textContent = `${state.owner}/${state.repo}`;
    }

    async function fetchJSON(url) {
      const res = await fetch(url, { headers: { 'Accept': 'application/vnd.github+json' }});
      if (!res.ok) throw new Error(`HTTP ${res.status}: ${url}`);
      return res.json();
    }

    function joinPath(...parts) {
      return parts.filter(Boolean).join('/');
    }

    function renderBreadcrumb() {
      const parts = state.path.split('/').filter(Boolean);
      let acc = '';
      const segs = [
        `<a href="#" data-path="">${state.repo}</a>`
      ];
      for (const p of parts) {
        acc = joinPath(acc, p);
        segs.push(`<span> / </span><a href="#" data-path="${acc}">${p}</a>`);
      }
      els.breadcrumb.innerHTML = segs.join('');
      els.breadcrumb.querySelectorAll('a[data-path]').forEach(a => {
        a.addEventListener('click', (e) => { e.preventDefault(); loadPath(a.getAttribute('data-path')); });
      });
    }

    async function loadBranches() {
      try {
        const data = await fetchJSON(`https://api.github.com/repos/${state.owner}/${state.repo}/branches`);
        els.branchSelect.innerHTML = '';
        data.forEach(b => {
          const opt = document.createElement('option');
          opt.value = b.name; opt.textContent = b.name;
          if (b.name === state.branch) opt.selected = true;
          els.branchSelect.appendChild(opt);
        });
        els.branchSelect.onchange = () => { state.branch = els.branchSelect.value; loadPath(state.path); };
      } catch (e) {
        console.warn('åˆ†æ”¯åŠ è½½å¤±è´¥ï¼ˆä½¿ç”¨é»˜è®¤åˆ†æ”¯ï¼‰', e);
      }
    }

    async function loadPath(path = '') {
      state.path = path;
      setTitle();
      renderBreadcrumb();
      els.content.innerHTML = '';
      els.readme.innerHTML = '';
      els.list.innerHTML = '<li class="muted">åŠ è½½ä¸­â€¦</li>';

      try {
        const url = `https://api.github.com/repos/${state.owner}/${state.repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(state.branch)}`;
        const items = await fetchJSON(url);
        renderList(Array.isArray(items) ? items : []);

        // é¦–é¡µæ˜¾ç¤º README
        if (!path) {
          await tryLoadReadme('');
        } else {
          // å­ç›®å½•å†…å¦‚æœæœ‰ README ä¹Ÿå¯æ˜¾ç¤ºåœ¨å†…å®¹åŒºåŸŸ
          await tryLoadReadme(path);
        }
      } catch (e) {
        els.list.innerHTML = `<li class="muted">åŠ è½½å¤±è´¥ï¼š${e.message}</li>`;
      }
    }

    function renderList(items) {
      // ç›®å½•ä¼˜å…ˆã€ç„¶å Markdownã€ç„¶åå…¶ä»–æ–‡ä»¶
      const dirs = items.filter(i => i.type === 'dir').sort((a,b)=> a.name.localeCompare(b.name));
      const mds  = items.filter(i => i.type === 'file' && /\.md$/i.test(i.name)).sort((a,b)=> a.name.localeCompare(b.name));
      const rest = items.filter(i => i.type === 'file' && !/\.md$/i.test(i.name)).sort((a,b)=> a.name.localeCompare(b.name));

      const makeLi = (icon, name, onClick, right = '') => {
        const li = document.createElement('li');
        li.innerHTML = `<div class="row"><div class="name">${icon} ${name}</div><div class="muted">${right}</div></div>`;
        li.addEventListener('click', onClick);
        return li;
      };

      els.list.innerHTML = '';
      if (dirs.length === 0 && mds.length === 0 && rest.length === 0) {
        els.list.innerHTML = '<div class="empty">ï¼ˆç©ºç›®å½•ï¼‰</div>';
        return;
      }

      dirs.forEach(d => {
        els.list.appendChild(
          makeLi('ğŸ“', d.name, () => loadPath(joinPath(state.path, d.name)))
        );
      });

      mds.forEach(f => {
        els.list.appendChild(
          makeLi('ğŸ“„', f.name, () => openMarkdown(joinPath(state.path, f.name)))
        );
      });

      rest.forEach(f => {
        const raw = `https://raw.githubusercontent.com/${state.owner}/${state.repo}/${state.branch}/${encodeURIComponent(joinPath(state.path, f.name))}`;
        els.list.appendChild(
          makeLi('ğŸ“', f.name, () => window.open(raw, '_blank'), f.size ? `${(f.size/1024).toFixed(1)} KB` : '')
        );
      });
    }

    async function tryLoadReadme(path) {
      const candidates = ['README.md', 'readme.md', 'Readme.md'];
      for (const name of candidates) {
        try {
          const raw = await fetchRaw(joinPath(path, name));
          if (raw) {
            const html = marked.parse(raw);
            els.readme.innerHTML = (path ? `<h3>${name}</h3>` : `<h2>README</h2>`) + html;
            return;
          }
        } catch (_) { /* ignore */ }
      }
    }

    async function fetchRaw(relPath) {
      const url = `https://raw.githubusercontent.com/${state.owner}/${state.repo}/${state.branch}/${relPath.split('/').map(encodeURIComponent).join('/')}`;
      const res = await fetch(url);
      if (res.ok) return await res.text();
      throw new Error(`HTTP ${res.status}`);
    }

    async function openMarkdown(relPath) {
      els.content.innerHTML = 'åŠ è½½ Markdownâ€¦';
      try {
        const md = await fetchRaw(relPath);
        els.content.innerHTML = marked.parse(md);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (e) {
        els.content.innerHTML = `<div class="muted">æ— æ³•åŠ è½½ï¼š${relPath}ï¼ˆ${e.message}ï¼‰</div>`;
      }
    }

    // åˆå§‹åŒ–
    (async function init(){
      setTitle();
      await loadBranches();
      await loadPath('');
    })();
  </script>
</body>
</html>