> 本Task中，我们的任务是使用进阶的机器学习模型lightgbm解决本次问题，以达到更好的预测效果。
> 
> 你可以从中学会
> - 使用数据集绘制柱状图和折线图，
> - 使用时间序列数据构建历史平移特征和窗口统计特征，
> - 使用lightgbm模型进行训练并预测。
> 
> 特征工程是参与机器学习竞赛的重要环节，可以通过**观察数据**并**结合专业背景知识**改善特征或者构建新的特征。
> 
> 机器学习中的一个经典理论是：**数据和特征决定了机器学习的上限，而模型和算法只是逼近这个上限。**

解决该问题常见思路
回归预测的常规思路一般为使用机器学习模型，如LightGBM、XGBoost，或者使用深度学习模型（神经网络等）进行实践，比较复杂。

task2使用机器学习模型解决本次问题，模型使用简单，数据不需要过多预处理；

使用机器学习方法一般主要需要从 **获取数据&增强**、**特征提取**和**模型**三个方面下手

使用机器学习模型解决问题的**主要步骤**为探索性数据分析、数据预处理、提取特征、切分训练集与验证集、训练模型、预测结果。

GBDT (Gradient Boosting Decision Tree) 是机器学习中一个长盛不衰的模型，其主要思想是利用弱分类器（决策树）迭代训练以得到最优模型，该模型具有训练效果好、不易过拟合等优点。

GBDT不仅在工业界应用广泛，通常被用于多分类、点击率预测、搜索排序等任务；在各种数据挖掘竞赛中也是致命武器，**据统计*Kaggle*上的比赛有一半以上的冠军方案都是基于GBDT**。

LightGBM（Light Gradient Boosting Machine）是一个实现GBDT算法的框架，支持高效率的并行训练，并且具有更快的训练速度、更低的内存消耗、更好的准确率、支持分布式可以快速处理海量数据等优点。

LightGBM 框架中还包括随机森林和逻辑回归等模型。通常应用于二分类、多分类和排序等场景。

例如：在个性化商品推荐场景中，通常需要做点击预估模型。使用用户过往的行为（点击、曝光未点击、购买等）作为训练数据，来预测用户点击或购买的概率。根据用户行为和用户属性提取一些特征，包括：

- 类别特征（Categorical Feature）：字符串类型，如性别（男/女）。
- 物品类型：服饰、玩具和电子等。
- 数值特征（Numrical Feature）：整型或浮点型，如用户活跃度或商品价格等。

```python
# 使用 read_csv() 函数从文件中读取训练集数据 文件名为'train.csv' 使用pandas库
train = pd.read_csv('train.csv')
# 使用 read_csv() 函数从文件中读取测试集数据 文件名为'test.csv' 使用pandas库
test = pd.read_csv('test.csv')

# 合并训练数据和测试数据，并进行排序
data = pd.concat([test, train], axis=0, ignore_index=True)
data = data.sort_values(['id','dt'], ascending=False).reset_index(drop=True)

# 历史平移
for i in range(10,30):
    data[f'last{i}_target'] = data.groupby(['id'])['target'].shift(i)

# 窗口统计
data[f'win3_mean_target'] = (data['last10_target'] + data['last11_target'] + data['last12_target']) / 3

# 进行数据切分
train = data[data.target.notnull()].reset_index(drop=True)
test = data[data.target.isnull()].reset_index(drop=True)
```
> [[0001.4 task2#^db322f|合并训练数据和测试数据，并进行排序]]
> [[0001.4 task2#^9da62a|历史平移]]
> [[0001.4 task2#^f435f3|窗口统计]]
> 

[[0001.4 task2|代码]]详解见[[004 task2#^81e210|文档]]

**特征工程**
这里主要构建了 **历史平移特征** 和 **窗口统计特征**；每种特征都是有理可据的，具体说明如下：

- **历史平移特征**：通过历史平移获取上个阶段的信息；如下图所示，可以将d-1时间的信息给到d时间，d时间信息给到d+1时间，这样就实现了平移一个单位的特征构建。
![[A000016.png]]
- **窗口统计特征**：窗口统计可以构建不同的窗口大小，然后基于窗口范围进统计均值、最大值、最小值、中位数、方差的信息，可以反映最近阶段数据的变化情况。如下图所示，可以将d时刻之前的三个时间单位的信息进行统计构建特征给我d时刻。
![[A000017.png]]
**滞后特征的作用**：
1. 捕捉时间依赖性
	1. 数据往往具有时间依赖性，当前时间点的值可能与之前时间点的值有关。股票价格、气温、销售量等都可能受到之前值的影响。
2. 构建预测模型
	1. 在时间序列预测中，使用滞后特征可以帮助模型了解过去的模式和趋势，从而更准确地预测未来。例如，预测某天的股票价格，可以使用前几天的价格作为特征。
3. 特征工程
	1. 在机器学习中，特征工程是提高模型性能的关键步骤。滞后特征是常用的特征工程方法之一，可以帮助模型捕捉时间序列数据的动态变化。


这里选择使用**Lightgbm模型**，也是通常作为数据挖掘比赛的基线模型，在不需要过程调参的情况的也能得到比较稳定的分数。
另外需要注意的训练集和验证集的构建：因为数据存在时序关系，所以需要严格按照时序进行切分，
- 这里选择原始给出训练数据集中dt为30之后的数据作为训练数据，**之前的数据作为验证数据**，
- 这样保证了数据不存在**穿越问题（不使用未来数据预测历史数据）**。



# 参考资料

- [task2笔记](https://datawhaler.feishu.cn/wiki/MaARwcr8li63nikSFRRciRKSnje) ^81e210
- [LightGBM中文文档](https://lightgbm.cn/)
- [LightGBM英文文档](https://lightgbm.readthedocs.io/en/latest/index.html)
- 